---
slug: deploy-dart-server-on-heroku
title: Deployment of a Dart Server on Heroku
description: "Getting your first server running is a fantastic feeling, in this article I explain you how."
date: 2022-04-03
author: max
tags:
- DevOps
- Dart
- Backend
---

import {TwitterFollowButton, TwitterHashtagButton} from "react-twitter-embed";

<TwitterFollowButton screenName="flutter_exp"/>

To run the first server is for every developer a fantastic and great experience.
It gives you a lot of options and possibilities and improves your general understanding of
software engineering. After we learned in my previous [videos](https://www.youtube.com/watch?v=kYM-wlOhQ3I&list=PLq83k-ITj6lQuw6asmdEbuNCV6vVwqT5c)
already how to start a server locally, we want in this article learn how to
make our server available in the world wide web so that you can access it from every device.

## Deployment
> Software deployment includes all activities that make a software system available to use. - [Wikipedia](https://en.wikipedia.org/wiki/Software_deployment)

In our use-case that means we want to access our server from every device that is
connected to the Internet and not only our local device in front of us. In professional
teams that task is being automated in most cases and transforms quickly. Into continuous deployment
where you work on your code, push to a repository and the deployment gets automatically triggered.
But in smaller teams or smaller organizations the preferred way is usually that a skilled professional performs
that task. And because we are skilled professionals, we do exactly that today.

## Prerequisites
There are just a few things we have to prepare to get started in the beautiful world of deployment
the first thing that we need is a physical server that will run our software server :).
For this reason we will use [Heroku](https://www.heroku.com/), because it allows us
to run our software for free in a small server [Virtual Machine (VM)](https://en.wikipedia.org/wiki/Virtual_machine)
that we can scale up if we want.

The other thing we need is a software server that we already build in the videos mentioned above.
For this deployment we will use the basic [shelf server](https://pub.dev/packages/shelf)
from Dart that we already run locally and made our first requests to. But this will also work
if you use a [aqueduct server](https://aqueduct.io/) or a [conduit server](https://www.theconduit.dev/).

**Summary what we need today:**
1. Heroku Account
2. Running Software Server
3. No previous knowledge about deployment processes

## Getting started
After you successfully created an Account on Heroku you will probably see a page that welcomes you to Heroku.
From here you could also create a new app but we will do it with the [Heroku CLI](https://devcenter.heroku.com/articles/heroku-cli).

### Heroku CLI
Great now that we have that covered lets jump right into it. To begin our journey to deploy
something on Heroku, we need to install the [`Heroku CLI`](https://devcenter.heroku.com/articles/heroku-cli).
Checkout the link of the Heroku CLI and select the system that fits your operating system.

Great the Heroku CLI will help us a lot to deploy our Server to the Heroku Server.
After the installation we first have to `login` against the Heroku system. For that execute
`heroku login` in your terminal. This will open a browser and allow you to log in to Heroku.

### Create a new Heroku app
The most convenient way to create a new Heroku app is via the CLI, for that open a terminal
and navigate to your workspace in which your project is. In our example it will be in
`~/dev/dart-server`. Now we want to create our app, for that we execute `heroku create <name-of-your-app>`
in our example we call the app `fe-dart-server`. If you do not pass a name it will
create a random app name for you.

```bash
heroku create fe-dart-server
Creating â¬¢ fe-dart-server... done
https://fe-dart-server.herokuapp.com/ | https://git.heroku.com/fe-dart-server.git
```

As a result Heroku delivers us two URLs the first one is the URL directly to our app.
Currently, we do not have an application running on `https://fe-dart-server.herokuapp.com/`
therefore you will find the documentation link of Heroku if you open it. The second link
is the internal git server of Heroku, from which it will use your source code to build the
project. That being said we will need to add a new remote to git to push our Dart project to.

```bash
# If you have not initialized your project with git
git init
git add remote heroku https://git.heroku.com/fe-dart-server.git
```
** Hint: It could be that if your project was already in git it was already
added with the heroku create command**

Now that we have your app registered to heroku we have to setup a [buildpack](https://devcenter.heroku.com/articles/buildpacks).

## How Heroku works
Now it is important to know how Heroku works. A build pack is responsible to transform your deployed source code
into a `slug`, which can then be executed by a `dyno`. You can read more about how Heroku works [here](https://devcenter.heroku.com/articles/how-heroku-works).
So before we go deeper into the topic lets quickly check what a slug and a dyno are.

> A `slug` is a bundle of your source, fetched dependencies, the language runtime, and compiled/generated output of the build system - ready for execution.

> `Dynos` are isolated, virtualized Unix containers, that provide the environment required to run an application.

Source: [devcenter.heroku.com](devcenter.heroku.com)

## Set up a build pack for Dart
Unfortunately Heroku is not yet supporting `Dart` with an official build pack. Therefore, we have to take advantage of
the fantastic Dart & Flutter Community who created already a build pack that we can use. We will use in this tutorial
the most starred build pack by [igrigorik](https://github.com/igrigorik).

To use the build pack we will have to tell heroku to use a specific download URL for the Dart language and configure the
build pack we want to use. To find a Dart SDK URL we check the [Dart Archive](https://dart.dev/get-dart/archive) page.
We select `linux` and the version we would like to install, in this example case it is the version `2.16.2` which is
the current version. Now right click on Dart SDK and copy the link address, we will need it in a second.

![How to get a Dart download URL](./dart-archive.png)

Now it is time to set the Dart URL and our `BUILDPACK_URL` for our Heroku app by executing in our terminal.

```bash
heroku config:set DART_SDK_URL=https://storage.googleapis.com/dart-archive/channels/stable/release/2.16.2/sdk/dartsdk-linux-x64-release.zip

Setting DART_SDK_URL and restarting â¬¢ fe-dart-server... done, v3
DART_SDK_URL: https://storage.googleapis.com/dart-archive/channels/stable/release/2.16.2/sdk/dartsdk-linux-x64-release.zip

heroku config:add BUILDPACK_URL=https://github.com/igrigorik/heroku-buildpack-dart.git

Setting BUILDPACK_URL and restarting â¬¢ fe-dart-server... done, v4
BUILDPACK_URL: https://github.com/igrigorik/heroku-buildpack-dart.git
```

Now it is time to push our source code to Heroku by pushing our source code to the remote git that we got when we created
our Heroku app.

```bash
git add .                           # Adds all files to git in this repository
git push --set-upstream heroku main # Sets the upstream branch to heroku main and pushes all files
```

If you are doing it in the terminal, heroku will give you a lot of logging information about the build process.

```
remote: -----> Discovering process types
remote:        Procfile declares types -> (none)
remote:
remote: -----> Compressing...
remote:        Done: 195.9M
remote: -----> Launching...
remote:        Released v7
remote:        https://fe-dart-server.herokuapp.com/ deployed to Heroku
remote:
remote: Verifying deploy... done.
To https://git.heroku.com/fe-dart-server.git
 	refs/heads/main:refs/heads/main	75c0e7f..b4f1198
Done
```

This tells you that everything was successful, but there is one step missing. We need to declare the dynos we want for our
app. For that we need to create a `Procfile` in our root directory of our project. There we enter the dyno and what it should
start to execute our server. In our case we execute the `dart_server.dart` in the bin folder.

```:title=Procfile
web: ./dart-sdk/bin/dart bin/dart_server.dart
```

Hint: The Procfile does **not** have a file extension like `.txt` or `.js`.

If we now `commit` and push again to the Heroku git server we are ready to see our server in action.

```bash
git commit -m "Added Procfile to setup the dyno"
git push --set-upstream heroku main
```

ðŸŽ‰ Great if everything worked well, you should have now your first running Dart Server on Heroku.

## Troubleshooting
As always there are some things that could go wrong and I try to add a collection that we found out during our [live stream](https://youtu.be/3zKC4RvJOII).

### Dynamic Port
Heroku does not provide you static port so every time the instance is started you will get a new port. Especially in
free mode that happens pretty frequently and therefore it is important that you take the PORT that is provided by the
`Environment variables` of Heroku.

```dart
var env = Platform.environment;

var port = env.entries.firstWhere((element) => element.key == 'PORT',
    orElse: () => MapEntry('PORT', '8080'));

var server = await shelf_io.serve(
  logRequests().addHandler(router), '0.0.0.0', int.parse(port.value));
```

### Replace localhost with 0.0.0.0
Heroku is pointing to itself while setup a server you will need to change `localhost` to 0.0.0.0

```dart
var server = await shelf_io.serve(
  logRequests().addHandler(router), '0.0.0.0', int.parse(port.value));
```

## Wrapping up
Great we did it, with these steps we were able to publish our server to Heroku and made our very first deployment possible.
The next milestone is to create a useful app out of this server. Maybe starting with a small quiz app that allows you
and your friends to learn more about development. For that you will probably need more insights into the [shelf_router package]()
or a even bigger solution like [conduit](https://conduit.dev). Feel free to share your first examples with me on Twitter
with the Hashtag `#FlutterExplained`. I cannot wait to see your results!

<TwitterHashtagButton tag="FlutterExplained"/>
